querying description logic knowledge bases has received great attention in the last years. in such a problem  the need of coping with incomplete information is the distinguishing feature with respect to querying databases. due to this feature  we have to deal with two conflicting needs: on the one hand  we would like to query the knowledge base with sophisticated mechanisms provided by full first-order logic  fol ; on the other hand  the presence of incomplete information makes query answering a much more difficult task than in databases. in this paper we advocate the use of a nonmonotonic epistemic fol query language as a means for expressing sophisticated queries over description logic knowledge bases. we show that through a controlled use of the epistemic operator  resulting in the language called eql-lite  we are able to formulate full fol queries over description logic knowledge bases  while keeping computational complexity of query answering under control. in particular  we show that eql-lite queries over dl-lite knowledge bases are fol reducible  i.e.  compilable into sql  and hence can be answered in logspace through standard database technologies.
1 introduction
querying description logic  dl  knowledge bases has received great attention in the last years. indeed  the definition of suitable query languages  and the design of query answering algorithms is arguably one of the crucial issues in applying dls to ontology management and to the semantic web .
모answering queries in dls must take into account the openworld semantics of such logics  and is therefore much more

      this research has been partially supported by fet project tones  thinking ontologies   funded by the eu under contract number fp1  by project hyper  funded by ibm through a shared university research  sur  award grant  and by miur firb 1 project  tecnologie orientate alla conoscenza per aggregazioni di imprese in internet   tocai.it .
difficult than in databases. for example  while first-order logic  fol  is the basis of any query language  e.g.  relational algebra and sql  for relational databases   it is wellknown that answering fol queries posed to dl knowledge bases is undecidable1. more precisely  to the best of our knowledge  the most expressive class of queries that go beyond instance checking  and for which decidability of query answering has been proved in dls  is the class of union of conjunctive queries  ucq   1; 1 . this restriction on the query language may constitute a serious limitation to the adoption of dls technology in information management tasks  such as those required in semantic web applications.
모the open-world semantics of dls  while being essential for representing incomplete information  may complicate the task of interpreting the answers by the users  or may call for the need of reasoning about the incompleteness of the knowledge base. for example  knowing that there are no parents with only female children  one might become interested in asking for all parents whose known children are all female. note that querying mechanisms such as the one mentioned in the example go beyond fol.
모to summarize  due to the need of coping with incomplete information in dl knowledge bases  two conflicting requirements arise in querying: on the one hand  we would like to query the knowledge base with powerful mechanisms that are able to reason about incompleteness  and on the other hand we aim at query languages that are both close in expressive power to fol  and decidable  and  possibly  tractable .
모this paper presents the following contributions. we define a query language for dl knowledge bases  called eql  see section 1   based on a variant of the well-known first-order modal logic of knowledge/belief  1; 1; 1 . the language incorporates a minimal knowledge operator k  which is used to formalize the epistemic state of the knowledge base. informally  the formula k뷋 is read as  뷋 is known to hold  by the knowledge base  . using this operator  we are able to pose queries that reason about the incompleteness of information represented by the knowledge base. for instance  a user can express queries that are able to incorporate closed-world reasoning on demand.
모we show  see section 1  that through a controlled use of the operator k  resulting in the language called eql-

1
indeed  query answering can be reduced to validity in fol.
lite q   we are able to formulate queries that are interesting both from the expressive power point of view  and from the computational complexity perspective. queries in eqllite q  have atoms that are expressed using a specific query language q  called embedded query language  and enjoy the property that they can be evaluated essentially with the same data complexity  i.e.  measured wrt the size of the abox only  as queries expressed in q.
모we investigate the properties of eql-lite q  for several interesting cases  characterizing the data complexity of query answering  see section 1 . in particular  we consider the following cases: shiq with simple concept and role expressions as embedded queries  dlr with embedded unions of conjunctive queries  ptime-complete dls such as hornshiq or el  with simple concept and role expressions as embedded queries  basic dls such as alc with epistemic conceptsas embeddedqueries  and highly tractable dls  such as those of the dl-litefamily  with embedded unions of conjunctive queries. for the latter case  we show that answering eql-lite ucq  is in logspace  and  notably  can be reduced to evaluating fol queries over the abox  when considered as a database. it follows that query processing in this setting can be done through standard database technologies.
finally  we briefly discuss  see section 1  the use of eql-
lite q  for introducing the notion of integrity constraints in
dl kbs.
1 epistemic query language
in this paper we consider queries over a description logic  dl  knowledge base . we don't focus on any particular dl. we simply assume that  through the dl  we are able to express our knowledge in terms of atomic concepts  i.e.  unary predicates  and atomic roles/relations  i.e.  binary/nary predicates. general concepts and roles/relations are built through the constructs allowed in the dl  and we assume that such constructs are expressible in fol. as usual  a dl knowledge base  kb  is formed by a set of assertions  typically divided into a tbox  expressing intensional knowledge  and an abox  expressing extensional knowledge. we assume again that such assertions can be expressed as fol sentences  i.e.  closed fol formulas . in other words  dl kbs can be seen as fol theories  of specific forms . observe that most dls fulfill such assumptions: the only notable exceptions are those that include some form of second-order constructs such as transitive closure or fixpoints .
모as usual  when talking about query answering  w.l.o.g.  we interpret dl kbs on interpretations sharing the same infinite countable domain 붟  and we assume that our language includes an infinitely countable set of disjoint constants corresponding to elements of 붟  also known as standard names . this allows us to blur the distinction between such constants  which are syntactic objects  and the elements of 붟 that they denote  which are semantical objects .
모as a query language  we make use of a variant of the wellknown first-order modal logic of knowledge/belief  1; 1; 1; 1   here called eql. the language eql is a first-order modal language with equality and with a single modal operator k  constructed from concepts  i.e.  unary predicates  and roles/relations  i.e.  binary/n-ary predicates  and the constants introduced above  i.e.  the standard names corresponding to 붟 . in eql  the modal operator is used to formalize the epistemic state of the dl kb  according to the minimal knowledge semantics  see later . informally  the formula k뷋 should be read as  뷋 is known to hold  by the kb  .
모in the following  we use c to denote a constant c to denote a tuple of constants  x to denote a variable  x to denote a tuple of variables  and 뷋  뷍 to denote arbitrary formulas  and 뷍cx to denote a formula where each x is replaced by c.
모a world is a fol interpretation over 붟. an epistemic interpretation is a pair e w  where e is a  possibly infinite  set of worlds  and w is a world in e. we inductively define when a sentence  i.e.  a closed formula  뷋 is true in an interpretation e w  or  is true in w and e   written e w |= 뷋  as follows:
iff	c1 = c1 iff 
e w |= 뷋1 뫇 뷋1 iff	e w |= 뷋1 and e w |= 뷋1 e w |=  뷋	iff
e w |=  x.뷍 ifffor some constant c e w |= k뷍 iff for every
모formulas without occurrences of k are said to be objective  since they talk about what is true. observe that to check whether e w |= 뷋  where 뷋 is an objective formula  we have to look at w but not at e: we only need the fol interpretation w. all assertions in the dl kb are indeed objective sentences. instead  formulas where each occurrence of predicates and of the equality is in the scope of the k operator are said to be subjective  since they talk about what is known to be true. observe that  for a subjective sentence 뷋  in order to establish whether e w |= 뷋 we do not have to look at w but only at e. we use such formulas to query what the kb knows. in other words  through subjective sentences we do not query information about the world represented by the kb; instead  we query the epistemic state of the kb itself. obviously there are formulas that are neither objective nor subjective. for example  x.p x  is an objective sentence  k  x.p x 뫇 kp x   is a subjective sentence  while  x.p x  뫇  kp x  is neither objective nor subjective.
모in our setting  among the various epistemic interpretations  we are interested in specific ones that represent the minimal epistemic state of the dl kb  i.e.  the state in which the kb has minimal knowledge. namely: let  be a dl kb  tbox and abox   and let mod   be the set of all fol-interpretations that are models of . then a -eqlinterpretation is an epistemic interpretation e w for which e = mod  . a sentence 뷋 is eql-logically implied by   written  |=eql 뷋  if for every -eql-interpretation e w we have e w |= 뷋. observe that for objective formulas such a definition becomes the standard one  namely w |= 뷋 for all w 뫍 mod    denoted by  |= 뷋.
모it is worth mentioning some of the most characterizing properties of eql.
proposition 1 for every dl kb  and every eql-sentence 뷋 we have:
 |=eql k뷋   뷋
 |=eql k뷋   kk뷋
 |=eql  k뷋   k k뷋
these are the standard s1 axioms of modal logic. the first one expresses that  what is known is true   knowledge is accurate   and the latter two express that the kb has  complete knowledge on what is known and not known .
proposition 1 for every dl kb  and every eql-sentence 뷋 we have that:
	 |=eql k뷋	or	 |=eql  k뷋
the above proposition tells us that for any sentence 뷋 the kb logically implies either that the sentence is known or that the sentence is not known  i.e.  we have complete information on what the kb knows. notably  this is a consequence of the minimal knowledge semantics that we are adopting.
proposition 1 for every dl kb  and every objective eqlsentence 뷋 we have:
 |= 뷋	iff	 |=eql k뷋 	iff	 |=eql  k뷋
모the above proposition relates knowledge to fol logical implication  and is again a consequence of the minimal knowledge semantics. it allows us to give a very concrete interpretation to knowledgefor objective sentences: 뷋 is known iff it is logically implied  otherwise it is not known.
모we are now ready to define eql-queries: an eql-query is simply an eql-formula  possibly an open one.
모let q be an eql-query with free variables x  where the arity of  and is called the arity of q. we sometimes use the notation  to make the free variables x explicit. also we use the notation to denote  i.e.  the formula obtained from q by substituting each free occurrence of the variable with the constant  where obviously x andc must have the same arity . since we are dealing with all the modelsof the kb  as usual  query answeringshould return those tuples of constants that make the query true in every model of the kb: the so-called certain answers. formally  the certain answers to a query over a kb  are the set ans
example 1 consider the dl kb  constituted by the following tbox t and abox a:
t	=	{ male	 female }
a = { female mary   female ann   female jane   male bob   male john   male paul  
parent bob mary  parent bob  ann  
parent  parent mary  jane  }
suppose we want to know the set of males that do not have female children. this corresponds to the following fol query q1:
q1 x  = male x  뫇   y.parent x y  뫇 female y 
it is easy to verify that the set of certain answers to q1 over  is empty. in particular  neither john nor paul are certain answers to the abovequery  since  dueto the open-worldsemantics of dls  there are models of  in which the interpretation of parent contains pairs of elements of the form  john x  or  paul x  and the interpretation of female contains the element x.
모suppose now that we want to know who are the known males that are not known to be parents of a female. this can be expressed by the following eql-query q1:
q1 x  = kmale x  뫇  k  y.parent x y  뫇 female y  
it is immediate to verify that the certain answers to q1 over  are john and paul  since they are the only known males that are not in the answer to the query  y.parent x y  뫇 female y .
모suppose now that we want to know who are the single children accordingto what is known  i.e.  the known children who have no known sibling. this can be expressed by the following eql-query q1:
q1 x  =  y. kparent y x   뫇
 z. kparent y z   뫸 z = x
it is immediate to verify that the certain answers to q1 over  are paul and jane.
모notice that  in an eql-query  we can apply a form of closed world reasoning: for example  in query q1 above  the evaluation of  k  y.parent x y 뫇female y   corresponds to the evaluation of   y.parent x y 뫇 female y  under the closed world assumption.
1 eql-lite q 
we introduce now the query language eql-lite q . such a language is a particularly well-behaved fragment of eql  and is parameterized with respect to an embedded query language q  which again is a subset of eql. informally  eql-lite q  is the fol query language with equality whose atoms are epistemic formulas of the form k where  is a query of q. formally  an eql-lite q  query is a possibly open eql-formula built according to the following syntax:

where  is a query in the embedded query language q. we call epistemic atoms the formulas k occurring in an eqllite q  query.
모observe that in eql-lite q  we do not allow the k operator to occur outside of the epistemic atoms k. indeed  allowing for occurrences of the k outside such atoms does not actually increase the expressive power of eql-lite q   as the following proposition shows.
proposition 1 let eql-lite q + be the extension of eql-
lite q  obtained by adding to the abstract syntax for eqllite q  formulas the rule 뷍 ::= k뷍. then  for each query q 뫍 eql-lite q +  there exists a queryeql-lite q  such that  for every epistemic interpretation e w.
in fact  aneql-lite q + queryq can be reduced to an equivalent eql-lite q  query q in linear time by simply pushing inward the k operator  stopping in front of the epistemic atoms  and simplifying kk뷍 to k뷍 and k k뷍 to  k뷍 whenever possible.
모eql-lite q  queries enjoy a very interesting computational property: one can decouple the reasoning needed for answering the epistemic atoms from the reasoning needed for answering the whole query. formally  let  be a dl kb  and be an eql-lite q  query over   whose epistemic atoms are k . we denote by the fol query obtained from q by replacing each epistemic atom ki by a new predicate whose arity is the number of free variables in i. also we denote by iq  the fol interpretation for the predicates defined as follows:  i  the interpretation domain is 붟iq  = 붟;  ii  the extension of the predicates ans . finally  we denote
by eval the result of evaluating qfol over iq .
theorem 1 let  be a dl kb  q aneql-lite q  query over   and qfol and iq  the fol query and the fol interpretation defined above. then ans q   = eval qfol iq  .
the theorem above tells us that  in order to compute the certain answers of an eql-lite q  query q  we can compute the certain answers of queries i of the embedded query language q occurring in the epistemic atoms of q  and then evaluate the query q as a fol query  where we consider such certain answers as the extensions of the epistemic atoms.
모the theorem above suggests a procedure to compute certain answers in eql-lite q . however  for such a procedure to be effective  we need to address two issues:  i  the extension of the predicates rki in the fol interpretation iq  needs to be finite  otherwise iq  would be infinite and the evaluation of qfol impossible in practice;  ii  since 붟 itself is infinite  the evaluation of qfol must not directly deal with 붟.
모we start by looking at the second issue first. such an issue has a long tradition in relational databases where indeed one allows only for fol queries that are  domain independent  . in our context  a fol query q is domain independent if for each pair of fol interpretations i1 and i1  respectively over domains 붟i1   붟 and 붟i1   붟  for which for all atomic relations   we have that eval q i1  = eval q i1 . we say that an eql-lite q  queryq is domain independentif its correspondingqueryqfol is so. domain independent fol queries correspond to relational algebra queries  i.e.  sql queries  and several syntactic sufficient conditions have been devised in order to guarantee domain independence see e.g.  . such syntactic conditions can be directly translated into syntactic conditions on eqllite q  queries.
모as for the other issue  let  be a dl kb and  a query of the embedded query language q. we say thatrange-restricted if ans is a finite set of tuples. by extension  an eql-lite q  query is -range-restricted if each of its epistemic atoms involves a -range-restricted query. in fact  the following proposition holds.
proposition 1 let  be a dl kb and-range-restricted query in the embedded query language q. then ans adom  뫄몫몫몫뫄adom  . where adom   is the set of all constants explicitly appearing in .
indeed  if a constant not appearing in  occurs in ans  then one can substitute such a constant with any other constant not appearing in   still getting a tuple in ans. thus  ans would be infinite.
모obviously it is of interest finding simple syntactic conditions that guarantee range-restrictedness. here we give just a trivial one  which is however quite practical in several cases. assume that we can introduce a new concept adom in the dl kb  and assert for each constant c occurring in  the abox assertion adom c . moreover  let's require that all queries in q must be of the form adom   where  x1 ... xn  and adom adom x1 뫇몫몫몫뫇 adom xn .
then trivially all queries in q are -range-restricted.
모now  if we considereql-lite q  queries that are both domain independent and -range-restricted  then we can effectively use the theorem above to compute the certain answers. moreover we can give a computational complexity characterization of query answering for eql-lite q  queries.
let q be an embedded query language  dl a dl  and
 cq dl the data complexity  i.e.  the complexity measured in the size of the abox only  of query answering for -rangerestricted queries of q over kbs  expressed in dl.1 we know that evaluating a domain independent fol query over a given fol interpretation is logspace in data complexity   and  by our assumptions  computing whether a tuple of constants is in the relation corresponding to the extension of an epistemic atom  can be done in cq dl in data complexity. hence  we immediately derivethe following result on the data complexity of answering domain independentand range-restrictedeql-lite q  queries  where we denote with  the class of languages recognized by a c1-turing ma-
chine that uses an oracle in c1.
theorem 1 let  be a kb expressed in the dl dl  and q a domain independent and -range-restricted eqllite q  query over . then  answering q over  is in
logspacecq dl with respect to data complexity  where cq dl is the data complexity of answering -rangerestricted queries of q over kbs  expressed in dl.
example 1 queries	q1 and	q1 in	example	1	are
eql-lite q  queries  where q is the language of conjunctive queries  in fact  for q1  q is the language of atomic queries . it is easy to verify that both such queries are domain independent  and that both are -range-restricted for the kb  given in example 1. in fact q1 and q1 are
-range-restricted for kbs  expressed  in practice  in any standard dl  indeed  the set ans parent x y    may never be infinite .
1 case studies
we discuss now several notable applications of the above results on eql-lite q  for specific combinations of the dl used to express the kb and of the embedded query language q. below  we implicitly refer to domain independent eqllite q  queries only.

1
모모as usual  when we speak about complexity of query answering  we actually mean the complexity of the associated recognition problem: i.e.  checking whether a tuple of constants is in the answer to a query .
shiq kbs and queries with embedded concept and role expressions. we consider the case in which kbs are specified in the expressive dl shiq   or equivalently  dlr    and the embedded query language q is that of range restricted shiq concept and role expressions. note that this case is very significant in practice since it captures in particular the form of queries supported by the racer and pellet systems  1; 1 . indeed  such queries are conjunctive queries over shiq concept and role expressions  in which  however  the existential quantification ranges over the named individuals in the abox only. now it turns out that such queries correspond to conjunctionsof -range-restricted shiq concept and role expressions prefixed by the k operator. since instance checking in shiq is conp-complete with respect to data complexity   by theorem 1 we get that in this case answering such queries  as well as every eql-lite q  query  is in logspacenp with respect to data complexity.
dlr kbs and queries with embedded unions of conjunctive queries. we consider the case in which kbs are again specified in an expressive dl like dlr or alcqi  and the embedded query language is that of -range-restricted unions of conjunctive queries  ucqs   i.e.  we consider queries expressed in eql-lite ucq . notice that the language of ucqs is currently the most expressive subset of fol for which query answering over kbs in an expressive dl  such as dlr  is known to be decidable   and in fact conpcomplete with respect to data complexity 1. from this characterization  and by applying again theorem 1  we get that answering -range-restricted eql-lite ucq  queries over dlr kbs is again in logspacenp with respect to data complexity.
ptime-complete dls for kbs and queries. next we consider the case in which kbs are specified in a ptimecomplete dl  such as horn-shiq  or el   and the embedded query language q is that of -range-restricted horn-shiq  resp.  el  concepts and role expressions. in this case  from theorem 1  we get that answering -rangerestricted eql-lite q  queries is in ptime  and  in fact ptime-complete  with respect to data complexity.
epistemic embedded query languages. in all the cases above the embedded query language consists of objective formulas. however  this does not need to be the case in general. let us  for example  consider kbs consisting of aboxes expressed in the basic dl alc and embedded queries consisting of concepts and roles expressed in alck   i.e.  alc extended with the k operator. then  since instance checking in alck concept and roles in alc aboxes can be done in pspace   by theorem 1 we get that  in this case  answering eql-lite q  queries is in pspace as well.

dl-lite kbs and queries with embedded unions of conjunctive queries. finally  we study the case in which kbs are specified using dls of the dl-lite family  1; 1  and the embedded query language q for eql-lite q  queries is again that of ucqs.
모the dl-lite family  1; 1  is a family of dls specifically tailored to deal with large amounts of data  i.e.  aboxes . while the expressive power of the dls in the dl-lite family is carefully controlled to admit tractable query answering  such dls are expressive enough to capture the main notions  though not all  obviously  of both ontologies  and of conceptual modeling formalisms used in databases and software engineering  i.e.  er and uml class diagrams . below  for simplicity  we denote by dl-liteany dl that is a member of the dl-litefamily.
모answering ucqs indl-liteis in logspace with respect to data complexity1. moreover  as a result of the tightly controlled expressive capabilities  we get the following.
proposition 1 let  be a dl-litekb  and let  be a ucq over . then -range-restricted.
as a consequence of theorem 1 and of membership in
logspace of the problem of answering ucqs over dllitekbs  we get that moving fromucqs toeql-lite ucq  does not change the data complexity of the query answering problem.
theorem 1 answering domain independent eqllite ucq  queries in dl-lite is in logspace with respect to data complexity.
모in fact we can refine such a result by resorting to the notion of fol-reducibility . intuitively  fol-reducibility means that query answering can be reduced to evaluating fol queries over a finite fol interpretation corresponding to the abox  which we assume contains assertions involving only atomic concepts and roles/relations  of a dl kb. all members of the dl-lite family enjoy fol-reducibility of ucqs . we now show that fol-reducibility holds also for domain independent eql-lite ucq  queries. given an abox a involving membership assertions on atomic concepts and roles only  we define the interpretation ia as follows:
- aia = a for each constant a 
- aia = {a | a a  뫍 a} for each atomic concept a  and
- for each atomic role
then  answering queries in a query language l  contained in eql  over a kb expressed in a dl dl is fol-reducible if for every query q 뫍 l and every tbox t expressed in dl  there exists a fol query rdc q  such that for every abox a  we have that ans q  t  a   = eval rdc q  ia . observe that fol-reducibility is a very meaningful property from a practical point of view. indeed  in all such cases in which query answering can be reduced to evaluation of a domain independent fol query  then such a query can be expressed in relational algebra  i.e.  in sql. therefore  query

answering can take full advantage of optimization strategies provided by current dbmss  which can be put in charge of managing aboxes in secondary storage . as shown in  1; 1   this property holds for answering of ucqs over dl-lite kbs. now  it turns out that the possibility of processing queries by relying on dbmss technology still holds foreqllite ucq  queries over dl-lite kbs.
theorem 1 answeringeql-lite ucq  queries indl-lite is fol-reducible. moreover  if the eql-lite ucq  query q is domain independent  then rdc q  is so as well.
as a consequence  to answer eql-lite ucq  queries in dllite  we can rely on traditional relational dbmss.
1 constraints
in this section we discuss an application of eql-lite q  to modeling integrity constraints in dl kbs. indeed  we argue that  in the spirit of   a boolean  i.e.  of arity 1  eqllite q  query can be seen as an integrity constraint.
모in particular  a dl kb  =  t  a   where t is a tbox and a is an abox  satisfies an integrity constraint 붺 expressed as a booleaneql-lite q  query if ans 붺   = true  i.e.   |=eql 붺. also   satisfies a set c of integrity constraints if for all 붺 뫍 c  ans 붺   = true.
모with this notion in place  we can revise the notion of dl kb: a dl kb with constraints is a triple  t  a c   where t is a tbox  a is an abox  and c is a set of integrity constraints expressed in eql-lite q . the semantics of such a dl kb  =  t  a c  is defined simply by specifying the set of models of  as follows:
satisfies c
모we say that a dl kb with constraints  is satisfiable if mod   is non-empty. notably  the results presented in the previous sections provide several cases where checking satisfiability of dl kbs with constraints can be effectively done  and the data complexity of such a check is fully characterized.
모also  the notions of -interpretation  logical implication  and certain answers ofeql queries  easily extend to dl kbs with constraints  as well as all complexity results for query answering in the new setting.
1 conclusions
motivated by various needs related to querying dl kbs  we have proposed the query languageeql  based on a variant of the well-known first-order modal logic of knowledge/belief. then  we have studied a subset of this language  called eqllite q   arguing that it allows for formulatingqueries that are interesting both from the expressive power point of view  and from the computational complexity perspective. finally  we have investigated the properties of eql-lite q  for various interesting cases.
모we are currently working on eql-lite q  for dl-lite kbs  for the case where q is the query language whose queries are either ucqs or comparison atoms involving values taken from a set of given domains  and we are currently implementing such an extended language within an existing dl reasoning system .
